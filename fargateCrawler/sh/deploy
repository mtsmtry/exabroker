npm run pack --prefix ../lib
cp -f ../lib/typeorm-0.2.29.tgz .
cp -f ../lib/exabroker-lib-1.0.0.tgz .
cp ../lib/chromedriverLinux .

npm link exabroker-lib
tsc

export tag=1.0
export localRep=exabroker-crawler:$tag
export remoteReg=203303191911.dkr.ecr.ap-northeast-1.amazonaws.com
export remoteRep=$remoteReg/exabroker-crawler:$tag
docker build --tag $localRep .
docker tag $localRep $remoteRep

aws ecr get-login-password | docker login --username AWS --password-stdin $remoteRep

docker push $remoteRep
aws ecs update-service --cluster exabroker-cluster --service exabroker-service | head

export taskId=`aws ecs list-tasks --desired-status RUNNING --cluster exabroker-cluster --family exabroker-crawler | grep arn | sed 's/[ "]//g'`
aws ecs stop-task --cluster exabroker-cluster --task $taskId --reason "Restarting task due to new ECR image deployment" | head